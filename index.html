<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ترتین بات </title>
  <style>
:root {
  --bg: #f4f7fb;
  --panel: #ffffff;
  --border: #e5e7eb;
  --text: #0f1724;
  --muted: #6b7280;
  --accent: #2b8cff;
  --bot-bubble: #eef6ff;
  --user-bubble: linear-gradient(135deg, #2b8cff, #0ea5e9);
  --radius: 14px;
  --logo: url("https://i.imgur.com/LOhBxAN.png");


  --header-bg: #ffffff;
  --header-border: #e5e7eb;
  --footer-bg: #ffffff;
  --footer-border: #e5e7eb;
}

[data-theme="dark"] {
  --bg: #0e1117;
  --panel: #161b22;
  --border: #2d333b;
  --text: #f3f4f6;
  --muted: #9ca3af;
  --bot-bubble: #1f2937;
  --user-bubble: linear-gradient(135deg, #2563eb, #1d4ed8);

  --header-bg: #1f2937;
  --header-border: #374151;
  --footer-bg: #1f2937;
  --footer-border: #374151;
}

html, body {
  height: 100%;
  margin: 0;
  padding: 0;
  background: var(--bg);
  color: var(--text);
  font-family: "Vazirmatn", sans-serif;
  direction: rtl;
  overflow: hidden; }


body {
  display: flex;
  justify-content: center;
  align-items: stretch; }


.app {
  width: 100%;
  height: 100vh; 
  background: var(--panel);
  border-radius: 16px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.05);
  display: flex;
  flex-direction: column;
  overflow: hidden; 
  margin: 0; 
}


header {
  display: flex;
  justify-content: center; 
  align-items: center;
  background: #1f2937;
  padding: 10px 15px;
  border-bottom: 1px solid #374151;
  position: sticky;
  top: 0;
  z-index: 100;
  direction: rtl;
  position: relative;
}

.profile {
  display: flex;
  justify-content: center;
  align-items: center;
}

.bot-avatar {
  width: 46px;
  height: 46px;
  border-radius: 50%;
  border: 2px solid #4b5563;
  box-shadow: 0 0 8px rgba(255,255,255,0.15);
  object-fit: cover;
}

.info {
  position: absolute;
  right: 15px;
  top: 50%;
  transform: translateY(-50%);
  text-align: right;
}

.info h1 {
  font-size: 18px;
  color: #fff;
  margin: 0;
  font-family: "Vazirmatn", sans-serif;
}

.controls {
  position: absolute;
  left: 15px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.bot-avatar {
  width:46px; height:46px; border-radius:50%;
  border:2px solid var(--border);
  box-shadow:0 0 8px rgba(255,255,255,0.15);
  object-fit:cover;
}

.info h1 {
  font-size:18px; margin:0; color:var(--text);
  font-weight:600; letter-spacing:-0.3px;
}

/* کنترل‌ها */
.controls {
  display:flex; align-items:center; gap:10px;
}

.controls button.toggle {
  display:flex; align-items:center; gap:4px;
  background:var(--border);
  color:var(--text);
  border:none; border-radius:8px; padding:6px 10px;
  cursor:pointer; transition: background .2s ease, transform .2s ease;
}

.controls button.toggle:hover {
  background:var(--muted); color:#fff; transform:translateY(-1px);
}


main.chat {
  flex: 1;
  overflow-y: auto;
  padding: 15px 20px;
  display:flex;
  flex-direction:column;
  gap:10px;
  background: var(--bg);
  scroll-behavior: smooth;
}


.msg {
  display:flex; align-items:flex-end; max-width:80%; position:relative;
}

.msg.bot { align-self:flex-start; margin-right:52px; }
.msg.user { align-self:flex-end; flex-direction:row-reverse; }

.bubble {
  padding:12px 14px; border-radius:var(--radius); font-size:14px; line-height:1.5;
  box-shadow:0 4px 12px rgba(0,0,0,0.05); position:relative; z-index:1;
}

.msg.bot .bubble {
  background:var(--bot-bubble); color:var(--text); border-radius:12px 12px 12px 6px;
}

.msg.user .bubble {
  background:var(--user-bubble); color:#fff; border-radius:12px 12px 6px 12px;
  box-shadow:0 6px 20px rgba(0,0,0,0.15);
}


.msg.bot::before {
  content:""; position:absolute; right:-52px; bottom:0; width:40px; height:40px;
  background:var(--logo); background-size:cover; background-position:center;
  border-radius:50%; opacity:0.95; box-shadow:0 2px 8px rgba(0,0,0,0.15);
}


.msg .copy-btn {
  position:absolute; top:8px; left:8px; opacity:0; transform:translateY(0);
  transition: opacity .18s ease, transform .18s ease;
  pointer-events:none; background:rgba(51,65,81,0.9); color:#fff; padding:6px 8px;
  border-radius:8px; font-size:12px; border:none; z-index:2;
}
.msg.user .copy-btn { left:auto; right:8px; }
.msg:hover .copy-btn { opacity:1; transform:translateY(-2px); pointer-events:auto; }


@media (hover: none), (pointer: coarse) {
  .msg .copy-btn { position:static; opacity:1; transform:none; pointer-events:auto; margin-top:6px; display:inline-flex; align-self:flex-start; }
  .msg.user .copy-btn { align-self:flex-end; }
  .msg .bubble { margin-top:6px; }
}


.loading-bubble { display:flex; align-items:center; justify-content:center; padding:6px 12px; }
.loading-dots { display:inline-flex; gap:4px; height:18px; }
.loading-dots span {
  width:6px; height:6px; background-color:var(--muted); border-radius:50%;
  animation: loadingDots 1.2s infinite ease-in-out;
}
.loading-dots span:nth-child(1){animation-delay:0s;}
.loading-dots span:nth-child(2){animation-delay:0.2s;}
.loading-dots span:nth-child(3){animation-delay:0.4s;}
@keyframes loadingDots {
  0%,80%,100%{transform:scale(0); opacity:0.3;}
  40%{transform:scale(1); opacity:1;}
}


.msg-actions {
  display:flex; gap:8px; opacity:0; margin-top:4px; transition: opacity .25s ease;
}
.msg.bot:hover .msg-actions { opacity:1; }
.msg-actions button {
  background:transparent; border:none; cursor:pointer; color:#9ca3af; padding:3px;
  transition: transform .15s ease, color .2s ease;
}
.msg-actions button:hover { color:#fff; transform:scale(1.15); }
.msg-actions button.liked svg path { fill:#ff3b5c; stroke:#ff3b5c; transform:scale(1.15); }

.link { color: #0ea5e9; }


footer {
  flex-shrink:0;
  display:flex; align-items:center; gap:10px; padding:10px 15px;
  background: var(--footer-bg);
  border-top: 1px solid var(--footer-border);
  position: sticky;
  bottom: 0;
  z-index: 10;
}

footer textarea {
  flex:1;height: 40px;; resize:none; border-radius:10px;
  padding:10px 12px; font-family:inherit;
  background:var(--panel); border:1px solid var(--border); color:var(--text);
}

footer button {
  background:var(--border); color:var(--text);
  border:none; border-radius:10px; padding:10px 15px; cursor:pointer;
  transition: background .2s ease, transform .2s ease;
}
footer button:hover { background:var(--muted); color:#fff; transform:translateY(-1px); }

#send { background:var(--accent); color:#fff; }
#send:hover { opacity:.85; }

#clear { background:#6b7280; color:#fff; }
#clear:hover { opacity:.9; }

.chat::-webkit-scrollbar { width:6px; }
.chat::-webkit-scrollbar-thumb { background:var(--accent); border-radius:10px; }
.chat::-webkit-scrollbar-track { background:transparent; }


@media (max-width:768px) {
  .app { height:100vh; border-radius:0; width:100%; max-width:100%; }
  header { padding:10px 12px; }
  footer { padding:10px; }
  footer textarea { font-size:13px; }
}
html, body {
  height: 100%;
  margin: 0;
  padding: 0;
  overflow: hidden;
}

.app {
  display: flex;
  flex-direction: column;
  min-height: 100%;
  background: #111827;
  overflow: hidden;
}

main.chat {
  flex: 1 1 auto;
  overflow-y: auto;
  padding: 15px 20px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  scroll-behavior: smooth;
  box-sizing: border-box;
}

footer {
  flex-shrink: 0;
  background: #1f2937;
  border-top: 1px solid #374151;
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px 15px;
  box-sizing: border-box;
}

footer textarea {
  flex: 1;
  background: #0f172a;
  border: 1px solid #374151;
  color: #fff;
  padding: 10px;
  border-radius: 10px;
  resize: none;
  font-family: inherit;
  font-size: 14px;
  line-height: 1.4;
  overflow-y: auto;
  min-height: 42px;
  max-height: 120px;
  box-sizing: border-box;
}

footer button {
  background: #374151;
  color: #fff;
  border: none;
  border-radius: 10px;
  padding: 10px 12px;
  cursor: pointer;
  transition: background 0.2s ease, transform 0.2s ease;
}

footer button:hover {
  background: #4b5563;
  transform: translateY(-1px);
}


@media (max-width: 768px) {
  html, body {
    overflow: auto; 
  }
  .app {
    min-height: 100dvh; 
  }
  footer {
    padding: 8px;
    gap: 8px;
  }
  footer textarea {
    font-size: 13px;
    min-height: 38px;
  }
  footer button {
    padding: 8px 10px;
    font-size: 13px;
  }
}
@media (max-width:768px) {
  html, body {
    overflow: hidden;
  }
  .app {
    height: 100dvh;
    border-radius: 0;
    width: 100%;
    max-width: 100%;
  }
  header { padding: 10px 12px; }
  main.chat { padding: 10px; }
  footer {
    padding: 8px;
    gap: 8px;
  }
  footer textarea {
    font-size: 13px;
    min-height: 38px;
  }
  footer button {
    padding: 8px 10px;
    font-size: 13px;
  }
}
</style>
</head>
<body data-theme="dark">
  <div class="app" role="application">
    <header>
      <div class="chat-header-left">
  <div class="profile">
    <img src="https://i.imgur.com/LOhBxAN.png" alt="ترتین‌بات" class="bot-avatar" />
    <div class="info">
      <h1>ترتین‌بات</h1>
    </div>
  </div>
</div>

      <div class="controls">
        <div id="status" class="small">آماده</div>
        <button id="themeToggle" class="toggle" title="تغییر تم">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden>
            <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
          </svg>
        </button>
        <button id="copyChat" class="toggle" title="کپی کل مکالمه">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden>
            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
            <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9"></path>
          </svg>
        </button>
      </div>
    </header>

    <main class="chat" id="chat" aria-live="polite"></main>

    <footer>
      <button id="send">
<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" role="img" aria-labelledby="sendTitle" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
  <title id="sendTitle">ارسال پیام</title>
  <path d="M22 2L11 13"></path>
  <path d="M22 2l-7 20  -4-9-9-4 20-7z" transform="translate(0 0)"></path>
</svg>
</button>
      <button id="clear" style="background:#374151"> 
<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" role="img" aria-labelledby="trashTitle" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
  <title id="trashTitle">حذف</title>
  <polyline points="3 6 5 6 21 6"></polyline>
  <path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"></path>
  <path d="M10 11v6"></path>
  <path d="M14 11v6"></path>
  <path d="M9 6V4a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2"></path>
</svg>
</button>
      <textarea id="input" placeholder="چی می‌خوای بدونی؟"></textarea>
    </footer>
  </div>

<script>
 
const realApi = 'http://hakhamanesh-bot.ir/api/gpt';


const chatEl = document.getElementById('chat');
const inputEl = document.getElementById('input');
const sendBtn = document.getElementById('send');
const clearBtn = document.getElementById('clear');
const statusEl = document.getElementById('status');
const themeToggle = document.getElementById('themeToggle');
const copyChat = document.getElementById('copyChat');

function escapeHTML(str) {
  if (!str) return '';
  return str.replace(/[&<>]/g, c => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;' }[c]));
}

async function tryFetchWithProxies(url) {
  let lastError;
  for (const proxy of proxies) {
    try {
      const fullUrl = proxy + encodeURIComponent(url);
      const res = await fetch(fullUrl);
      if (!res.ok) throw new Error(`پاسخ نامعتبر از ${proxy} (${res.status})`);
      return res;
    } catch (err) {
      console.warn(`⚠️ خطا از ${proxy}: ${err.message}`);
      lastError = err;
    }
  }


  try {
    const direct = await fetch(url);
    if (!direct.ok) throw new Error(`پاسخ نامشخص از سرور مستقیم (${direct.status})`);
    return direct;
  } catch (err) {
    console.error('❌ تمام پروکسی‌ها شکست خوردن:', err.message);
    throw lastError || err;
  }
}


function formatResponse(text) {
  if (!text) return '';
  return escapeHTML(text).replace(/\n/g, '<br>');
}

function appendMessage(text, who = 'bot', isHTML = false) {
  const msg = document.createElement('div');
  msg.className = 'msg ' + (who === 'user' ? 'user' : 'bot');


  const bubble = document.createElement('div');
  bubble.className = 'bubble';
  bubble.innerHTML = isHTML ? text : formatResponse(text);
  msg.appendChild(bubble);

  if (who === 'bot') {
    const actions = document.createElement('div');
    actions.className = 'msg-actions';

    const icon = (path, title = '') => {
      const btn = document.createElement('button');
      btn.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="17" height="17" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          ${path}
        </svg>`;
      btn.title = title;
      return btn;
    };

    const copyBtn = icon('<rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9"></path>', 'کپی');
    copyBtn.addEventListener('click', () => {
      navigator.clipboard.writeText(bubble.innerText || bubble.textContent);
      copyBtn.style.color = '#22c55e';
      setTimeout(() => (copyBtn.style.color = ''), 1000);
    });

    const likeBtn = icon('<path d="M20.8 4.6a5.5 5.5 0 00-7.8 0L12 5.6l-1-1a5.5 5.5 0 00-7.8 7.8l1 1L12 21l7.8-7.6 1-1a5.5 5.5 0 000-7.8z"></path>', 'لایک');
    likeBtn.addEventListener('click', () => {
      likeBtn.classList.toggle('liked');
    });

    const regenBtn = icon('<polyline points="23 4 23 10 17 10"></polyline><path d="M20.49 15a9 9 0 11-2.12-9.36L23 10"></path>', 'پردازش دوباره');
    regenBtn.addEventListener('click', () => {
      const lastUser = [...document.querySelectorAll('.msg.user .bubble')].pop();
      if (lastUser) sendText(lastUser.textContent.trim());
    });

    const shareBtn = icon('<path d="M4 12v8a2 2 0 002 2h12a2 2 0 002-2v-8"></path><polyline points="16 6 12 2 8 6"></polyline><line x1="12" y1="2" x2="12" y2="15"></line>', 'اشتراک‌گذاری');
    shareBtn.addEventListener('click', async () => {
      const txt = bubble.innerText || bubble.textContent;
      if (navigator.share) {
        await navigator.share({ text: txt, title: 'پیام ترتین‌بات' });
      } else {
        navigator.clipboard.writeText(txt);
        shareBtn.style.color = '#22c55e';
        setTimeout(() => (shareBtn.style.color = ''), 1000);
      }
    });

    actions.append(copyBtn, likeBtn, regenBtn, shareBtn);
    msg.appendChild(actions);
  }

  chatEl.appendChild(msg);
  chatEl.scrollTop = chatEl.scrollHeight;
  return bubble;
}


function typeWriter(element, text, speed = 15) {
  element.innerHTML = '';
  let i = 0;
  return new Promise(resolve => {
    const timer = setInterval(() => {
      element.innerHTML += escapeHTML(text.charAt(i));
      chatEl.scrollTop = chatEl.scrollHeight;
      i++;
      if (i >= text.length) {
        clearInterval(timer);
        resolve();
      }
    }, speed);
  });
}

function saveChatToLocal() {
  try {
    localStorage.setItem('tertin_chat', chatEl.innerHTML);
  } catch {}
}
function loadChatFromLocal() {
  try {
    const s = localStorage.getItem('tertin_chat');
    if (s) chatEl.innerHTML = s;
  } catch {}
}
loadChatFromLocal();

async function sendText(text) {
  if (!text.trim()) return;

  appendMessage(text, 'user');
  inputEl.value = '';

  const loadingBubble = appendMessage(`
    <div class="loading-bubble">
      <div class="loading-dots"><span></span><span></span><span></span></div>
    </div>
  `, 'bot', true);
  statusEl.textContent = 'در حال ارتباط با سرور...';

  try {
    const basePrompt = '(نکته پیش فرض: تو ترتین بات هستی که توسط ماهان(13) ساخته شدی ماهان یک برنامه نویس ایرانی ساکن مشهد هست و 18 سالشه لینک وبسایت اون https://api-code.ir/max/html/RMZ13.html اون  لینک کانال روبیکا او:@Thirteen_Developer تا وقتی راجب سازندت نپرسیدم راجبش حرف نزن)';
    const fullPrompt = `${basePrompt} ${text}`;
    const targetUrl = `${realApi}?text=${encodeURIComponent(fullPrompt)}`;

    const res = await tryFetchWithProxies(targetUrl);
    const raw = await res.text(); 
    console.log('🛰 پاسخ خام از سرور:', raw);

    let data;
    try {
      data = JSON.parse(raw);
    } catch {
      data = raw;
    }

    let answer = '(پاسخ نامشخص)';
    if (typeof data === 'string') {
      answer = data;
    } else if (data.contents) {
      try {
        const inner = JSON.parse(data.contents);
        answer = inner.answer || inner.response || data.contents;
      } catch {
        answer = data.contents;
      }
    } else if (data.answer || data.response || data.result) {
      answer = data.answer || data.response || data.result;
    } else if (data.error) {
      throw new Error(data.error);
    }

    if (/failed to contact HuggingFace/i.test(answer)) {
      throw new Error('ارتباط با سرور هوش مصنوعی قطع شده، لطفاً بعداً دوباره امتحان کن.');
    }

    loadingBubble.innerHTML = '';
    await typeWriter(loadingBubble, answer, 12);
    statusEl.textContent = 'آماده';
    saveChatToLocal();
  } catch (err) {
    console.error('❌ خطا در ارسال:', err);
    loadingBubble.remove();
    statusEl.textContent = 'خطا';
    appendMessage(`❌ خطا در اتصال به سرور: ${escapeHTML(err.message)}`, 'bot', true);
    saveChatToLocal();
  }
}


sendBtn.addEventListener('click', () => sendText(inputEl.value));
inputEl.addEventListener('keydown', e => {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    sendText(inputEl.value);
  }
});
clearBtn.addEventListener('click', () => {
  chatEl.innerHTML = '';
  statusEl.textContent = 'آماده';
  localStorage.removeItem('tertin_chat');
});
copyChat.addEventListener('click', () => {
  navigator.clipboard.writeText(chatEl.innerText || '');
  copyChat.innerText = '✅ کپی شد';
  setTimeout(() => (copyChat.innerText = '📋 کپی چت'), 1500);
});

function toggleTheme() {
  const next = document.body.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
  document.body.setAttribute('data-theme', next);
  localStorage.setItem('tertin_theme', next);
}
themeToggle.addEventListener('click', toggleTheme);
(function () {
  const t = localStorage.getItem('tertin_theme');
  if (t) document.body.setAttribute('data-theme', t);
})();

appendMessage('سلام! ✨ من ترتین‌بات هستم. چه کمکی ازم برمیاد؟', 'bot', true);

setInterval(saveChatToLocal, 2000);

</script>

</body>
</html>

